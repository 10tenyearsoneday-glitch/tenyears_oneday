<!doctype html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>十年一日｜內建編輯器（匯出 JSON）</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+TC:wght@300;400;600&family=Inter:wght@300;400;600&display=swap" rel="stylesheet">
  <style>
    :root{--bg1:#eef4ee;--bg2:#e6efe6;--green:#1f2b22;--sage:#6f7f73;--line:#d7e1d8;--card:rgba(255,255,255,.9);
      --r:18px;--serif:"Noto Serif TC", serif;}
    *{box-sizing:border-box}
    body{margin:0;font-family:var(--serif);background:linear-gradient(180deg,var(--bg1),var(--bg2));color:#2f3c33}
    .wrap{max-width:980px;margin:0 auto;padding:22px 16px 32px}
    h1{margin:0 0 10px;letter-spacing:.10em;font-weight:400;color:var(--green)}
    p{margin:6px 0 0;color:var(--sage);line-height:1.8}
    .card{margin-top:16px;background:var(--card);border:1px solid var(--line);border-radius:var(--r);padding:16px;box-shadow:0 14px 40px rgba(0,0,0,.10)}
    label{display:block;font-size:13px;color:var(--sage);letter-spacing:.04em;margin:12px 0 6px}
    input,textarea{width:100%;border:1px solid var(--line);border-radius:12px;padding:10px 12px;font-family:var(--serif);font-size:14px;background:rgba(255,255,255,.8);color:#2f3c33;outline:none}
    textarea{min-height:110px;resize:vertical}
    .row{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    .btns{display:flex;gap:10px;flex-wrap:wrap;margin-top:14px}
    button{border:1px solid rgba(31,43,34,.18);background:rgba(31,43,34,.06);color:var(--green);font-family:var(--serif);border-radius:999px;padding:10px 14px;font-size:13px;letter-spacing:.04em;cursor:pointer}
    button.ghost{background:rgba(255,255,255,.7);border-color:var(--line);color:#2f3c33}
    .small{font-size:12px}.muted{color:rgba(111,127,115,.95);font-style:italic}
    code{font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono","Courier New", monospace;font-size:12px}
    @media (max-width:820px){.row{grid-template-columns:1fr}}
  </style>
</head>
<body>
  <div class="wrap">
    <h1>內建編輯器（匯出 JSON）</h1>
    <p>這不是需要登入的「真正後台」（會牽涉安全與伺服器）。它的用途是：<b>用表單改內容 → 下載 JSON → 覆蓋到 <code>/data/content.json</code></b>，就能立刻改網站。</p>

    <div class="card">
      <div class="row">
        <div>
          <label>品牌中文名</label>
          <input id="brand_name_zh" placeholder="十年一日">
        </div>
        <div>
          <label>品牌英文名</label>
          <input id="brand_name_en" placeholder="TEN YEARS ONE DAY">
        </div>
      </div>

      <div class="row">
        <div>
          <label>帳號（斜體那行）</label>
          <input id="handle" placeholder="tenyears_oneday">
        </div>
        <div>
          <label>免運活動文字</label>
          <input id="free_shipping_text" placeholder="免運活動：滿 NT$1,200 免運（可隨時更改）">
        </div>
      </div>

      <label>公告內容</label>
      <textarea id="announcement_text"></textarea>

      <label>歡迎卡片內容（可換行）</label>
      <textarea id="welcome_body"></textarea>

      <div class="btns">
        <button id="btnLoad" class="ghost">讀取目前 data/content.json</button>
        <button id="btnExport">下載 content.json</button>
        <button id="btnHelp" class="ghost">我需要怎麼覆蓋？</button>
      </div>

      <p class="small muted" style="margin-top:10px;">提示：改完後下載的檔案，直接在 GitHub 把 <code>data/content.json</code> 上傳覆蓋即可。</p>
    </div>
  </div>

  <script>
    async function load(){
      const res = await fetch("../data/content.json", { cache: "no-store" });
      if(!res.ok) throw new Error("load failed");
      return await res.json();
    }
    function setVal(id, v){ const el=document.getElementById(id); if(el) el.value=v ?? ""; }
    function getVal(id){ const el=document.getElementById(id); return el ? el.value : ""; }

    function fill(c){
      setVal("brand_name_zh", c.brand_name_zh);
      setVal("brand_name_en", c.brand_name_en);
      setVal("handle", c.handle);
      setVal("free_shipping_text", c.free_shipping_text);
      setVal("announcement_text", c.announcement_text);
      setVal("welcome_body", c.welcome_body);
    }

    function collect(){
      return {
        brand_name_zh: getVal("brand_name_zh"),
        brand_name_en: getVal("brand_name_en"),
        handle: getVal("handle"),
        hero_title: getVal("brand_name_zh"),
        hero_subtitle: "時光淬鍊・破碎中尋覓永恆\n每一件飾品 都是時間的詩篇",
        welcome_title: "歡迎來到 十年一日",
        welcome_tagline: "Every piece tells a story.",
        welcome_body: getVal("welcome_body"),
        announcement_label: "公告",
        announcement_text: getVal("announcement_text"),
        free_shipping_text: getVal("free_shipping_text"),
        footer_text: "© 十年一日 " + getVal("handle")
      };
    }

    function downloadJSON(obj, filename){
      const blob = new Blob([JSON.stringify(obj, null, 2)], { type: "application/json" });
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = filename;
      document.body.appendChild(a);
      a.click();
      a.remove();
      URL.revokeObjectURL(url);
    }

    document.getElementById("btnLoad").addEventListener("click", async () => {
      try{
        const c = await load();
        fill(c);
        alert("已載入目前 content.json");
      }catch(e){
        alert("載入失敗：請確認此頁是在 GitHub Pages / 靜態主機上開啟。");
      }
    });

    document.getElementById("btnExport").addEventListener("click", () => {
      downloadJSON(collect(), "content.json");
    });

    document.getElementById("btnHelp").addEventListener("click", () => {
      alert("覆蓋方式：\n1) 打開你的 GitHub repo\n2) 進入 data/content.json\n3) 點鉛筆編輯，貼上你下載檔案的內容（或上傳覆蓋）\n4) Commit changes\n5) 等 30 秒刷新網站");
    });

    load().then(fill).catch(()=>{});
  </script>
</body>
</html>
